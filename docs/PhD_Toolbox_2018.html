<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>PhD Toolbox 2018 - Reproducible Research</title>
  <meta name="description" content="PhD Toolbox 2018 - Reproducible Research">
  <meta name="generator" content="bookdown 0.5 and GitBook 2.6.7">

  <meta property="og:title" content="PhD Toolbox 2018 - Reproducible Research" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="PhD-Toolbox-course/2018_PhD_Toolbox_course" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="PhD Toolbox 2018 - Reproducible Research" />
  
  
  

<meta name="author" content="Marco Chiapello">


<meta name="date" content="2018-01-22">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  


<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path=""><a href="#preface"><i class="fa fa-check"></i><b>1</b> Preface</a><ul>
<li class="chapter" data-level="1.1" data-path=""><a href="#caution"><i class="fa fa-check"></i><b>1.1</b> Caution</a></li>
<li class="chapter" data-level="1.2" data-path=""><a href="#installation"><i class="fa fa-check"></i><b>1.2</b> Installation</a></li>
<li class="chapter" data-level="1.3" data-path=""><a href="#license"><i class="fa fa-check"></i><b>1.3</b> License</a></li>
<li class="chapter" data-level="1.4" data-path=""><a href="#contact"><i class="fa fa-check"></i><b>1.4</b> Contact</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path=""><a href="#an-introduction-to-machine-learning-with-r"><i class="fa fa-check"></i><b>2</b> An Introduction to Machine Learning with R</a><ul>
<li class="chapter" data-level="2.1" data-path=""><a href="#objectives-and-pre-requisites"><i class="fa fa-check"></i><b>2.1</b> Objectives and pre-requisites</a></li>
<li class="chapter" data-level="2.2" data-path=""><a href="#why-r"><i class="fa fa-check"></i><b>2.2</b> Why R?</a></li>
<li class="chapter" data-level="2.3" data-path=""><a href="#overview-of-machine-learning-ml"><i class="fa fa-check"></i><b>2.3</b> Overview of machine learning (ML)</a></li>
<li class="chapter" data-level="2.4" data-path=""><a href="#material-and-methods"><i class="fa fa-check"></i><b>2.4</b> Material and methods</a><ul>
<li class="chapter" data-level="2.4.1" data-path=""><a href="#example-data"><i class="fa fa-check"></i><b>2.4.1</b> Example data</a></li>
<li class="chapter" data-level="2.4.2" data-path=""><a href="#packages"><i class="fa fa-check"></i><b>2.4.2</b> Packages</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path=""><a href="#unsupervised-learning"><i class="fa fa-check"></i><b>3</b> Unsupervised Learning</a><ul>
<li class="chapter" data-level="3.1" data-path=""><a href="#introduction"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path=""><a href="#k-means-clustering"><i class="fa fa-check"></i><b>3.2</b> k-means clustering</a><ul>
<li class="chapter" data-level="3.2.1" data-path=""><a href="#how-does-k-means-work"><i class="fa fa-check"></i><b>3.2.1</b> How does k-means work</a></li>
<li class="chapter" data-level="3.2.2" data-path=""><a href="#model-selection"><i class="fa fa-check"></i><b>3.2.2</b> Model selection</a></li>
<li class="chapter" data-level="3.2.3" data-path=""><a href="#how-to-determine-the-number-of-clusters"><i class="fa fa-check"></i><b>3.2.3</b> How to determine the number of clusters</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path=""><a href="#hierarchical-clustering"><i class="fa fa-check"></i><b>3.3</b> Hierarchical clustering</a><ul>
<li class="chapter" data-level="3.3.1" data-path=""><a href="#how-does-hierarchical-clustering-work"><i class="fa fa-check"></i><b>3.3.1</b> How does hierarchical clustering work</a></li>
<li class="chapter" data-level="3.3.2" data-path=""><a href="#defining-clusters"><i class="fa fa-check"></i><b>3.3.2</b> Defining clusters</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path=""><a href="#pre-processing"><i class="fa fa-check"></i><b>3.4</b> Pre-processing</a></li>
<li class="chapter" data-level="3.5" data-path=""><a href="#principal-component-analysis-pca"><i class="fa fa-check"></i><b>3.5</b> Principal component analysis (PCA)</a><ul>
<li class="chapter" data-level="3.5.1" data-path=""><a href="#how-does-it-work"><i class="fa fa-check"></i><b>3.5.1</b> How does it work</a></li>
<li class="chapter" data-level="3.5.2" data-path=""><a href="#visualisation"><i class="fa fa-check"></i><b>3.5.2</b> Visualisation</a></li>
<li class="chapter" data-level="3.5.3" data-path=""><a href="#data-pre-processing"><i class="fa fa-check"></i><b>3.5.3</b> Data pre-processing</a></li>
<li class="chapter" data-level="3.5.4" data-path=""><a href="#final-comments-on-pca"><i class="fa fa-check"></i><b>3.5.4</b> Final comments on PCA</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path=""><a href="#t-distributed-stochastic-neighbour-embedding"><i class="fa fa-check"></i><b>3.6</b> t-Distributed Stochastic Neighbour Embedding</a><ul>
<li class="chapter" data-level="3.6.1" data-path=""><a href="#parameter-tuning"><i class="fa fa-check"></i><b>3.6.1</b> Parameter tuning</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">PhD Toolbox 2018 - Reproducible Research</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="header">
<h1 class="title">PhD Toolbox 2018 - Reproducible Research</h1>
<h4 class="author"><em>Marco Chiapello</em></h4>
<h4 class="date"><em>2018-01-22</em></h4>
</div>
<section id="preface" class="level1">
<h1><span class="header-section-number">Chapter 1</span> Preface</h1>
<p>This course material is aimed at people who are already familiar with the R language and syntax, and who would like to get a hands-on introduction to reproducible research</p>
<section id="caution" class="level2">
<h2><span class="header-section-number">1.1</span> Caution</h2>
<p>This material is currently under development and is likely to change in the future.</p>
</section>
<section id="installation" class="level2">
<h2><span class="header-section-number">1.2</span> Installation</h2>
<p>A set of packages that are used, either directly or indirectly are provided in the first chapter. A complete session information with all packages used to compile this document is available at the end.</p>
<p>The source code for this document is available on GitHub at <a href="https://github.com/PhD-Toolbox-course/2018_PhD_Toolbox_course" class="uri">https://github.com/PhD-Toolbox-course/2018_PhD_Toolbox_course</a></p>
<p>A short URL for this book is <a href="http://bit.ly/intromlr" class="uri">http://bit.ly/intromlr</a></p>
</section>
<section id="license" class="level2">
<h2><span class="header-section-number">1.3</span> License</h2>
<p>This material is licensed under the <a href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike 3.0 License</a>. Some content is inspired by other sources though, see the <em>Credit</em> section in the material.</p>
</section>
<section id="contact" class="level2">
<h2><span class="header-section-number">1.4</span> Contact</h2>
<p>Feel free to contact me for any question or comments, preferably by <a href="https://github.com/PhD-Toolbox-course/2018_PhD_Toolbox_course/issues">opening an issue</a> on GitHub.</p>

</section>
</section>
<section id="an-introduction-to-machine-learning-with-r" class="level1">
<h1><span class="header-section-number">Chapter 2</span> An Introduction to Machine Learning with R</h1>
<p>This introductory workshop on machine learning with R is aimed at participants who are not experts in machine learning (introductory material will be presented as part of the course), but have some familiarity with scripting in general and R in particular. The workshop will offer a hands-on overview of typical machine learning applications in R, including unsupervised (clustering, such as hierarchical and k-means clustering, and dimensionality reduction, such as principal component analysis) and supervised (classification and regression, such as K-nearest neighbour and linear regression) methods. We will also address questions such as model selection using cross-validation. The material has an important hands-on component and readers should have a computer running R 3.4.1 or later.</p>
<section id="objectives-and-pre-requisites" class="level2">
<h2><span class="header-section-number">2.1</span> Objectives and pre-requisites</h2>
<ul>
<li><p>The course aims at providing an accessible introduction to various machine learning methods and applications in R. The core of the courses focuses on unsupervised and supervised methods.</p></li>
<li><p>The course contains numerous exercises to provide numerous opportunity to apply the newly acquired material.</p></li>
<li><p>Participants are expected to be familiar with the R syntax and basic plotting functionality.</p></li>
<li><p>At the end of the course, the participants are anticipated to be able to apply what they have learnt, as well as feel confident enough to explore and apply new methods.</p></li>
</ul>
</section>
<section id="why-r" class="level2">
<h2><span class="header-section-number">2.2</span> Why R?</h2>
<p>R is one of the major languages for data science. It provides excellent visualisation features, which is essential to explore the data before submitting it to any automated learning, as well as assessing the results of the learning algorithm. Many R package for <a href="https://cran.r-project.org/">machine learning</a> are available of the shelf and many modern methods in statistical learning are implemented in R as part of their development.</p>
<p>There are however other viable alternatives that benefit from similar advantages. If we consider python for example, the <a href="http://scikit-learn.org/stable/index.html">scikit-learn</a> software provides all the tools that we will discuss in this course.</p>
</section>
<section id="overview-of-machine-learning-ml" class="level2">
<h2><span class="header-section-number">2.3</span> Overview of machine learning (ML)</h2>
<p>In <strong>supervised learning</strong> (SML), the learning algorithm is presented with labelled example inputs, where the labels indicate the desired output. SML itself is composed of <strong>classification</strong>, where the output is categorical, and <strong>regression</strong>, where the output is numerical.</p>
<p>In <strong>unsupervised learning</strong> (UML), no labels are provided, and the learning algorithm focuses solely on detecting structure in unlabelled input data.</p>
<p>Note that there are also <strong>semi-supervised learning</strong> approaches that use labelled data to inform unsupervised learning on the unlabelled data to identify and annotate new classes in the dataset (also called novelty detection).</p>
<p><strong>Reinforcement learning</strong>, the learning algorithm performs a task using feedback from operating in a real of synthetic environment.</p>
</section>
<section id="material-and-methods" class="level2">
<h2><span class="header-section-number">2.4</span> Material and methods</h2>
<section id="example-data" class="level3">
<h3><span class="header-section-number">2.4.1</span> Example data</h3>
<ul>
<li><em>Observations</em>, <em>examples</em> or simply <em>data points</em> along the rows</li>
<li><em>Features</em> or <em>variables</em> along the columns</li>
</ul>
<p>Using the <em>iris</em> data as an example, for UML, we would have 4 features for each unlabelled example.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: right;">Sepal.Length</th>
<th style="text-align: right;">Sepal.Width</th>
<th style="text-align: right;">Petal.Length</th>
<th style="text-align: right;">Petal.Width</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">3.5</td>
<td style="text-align: right;">1.4</td>
<td style="text-align: right;">0.2</td>
</tr>
<tr class="even">
<td style="text-align: right;">4.9</td>
<td style="text-align: right;">3.0</td>
<td style="text-align: right;">1.4</td>
<td style="text-align: right;">0.2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4.7</td>
<td style="text-align: right;">3.2</td>
<td style="text-align: right;">1.3</td>
<td style="text-align: right;">0.2</td>
</tr>
<tr class="even">
<td style="text-align: right;">4.6</td>
<td style="text-align: right;">3.1</td>
<td style="text-align: right;">1.5</td>
<td style="text-align: right;">0.2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5.0</td>
<td style="text-align: right;">3.6</td>
<td style="text-align: right;">1.4</td>
<td style="text-align: right;">0.2</td>
</tr>
<tr class="even">
<td style="text-align: right;">5.4</td>
<td style="text-align: right;">3.9</td>
<td style="text-align: right;">1.7</td>
<td style="text-align: right;">0.4</td>
</tr>
</tbody>
</table>
<p>The same dataset used in the context of SML contains an additional column of labels, documenting the outcome or class of each example.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Species</th>
<th style="text-align: right;">Sepal.Length</th>
<th style="text-align: right;">Sepal.Width</th>
<th style="text-align: right;">Petal.Length</th>
<th style="text-align: right;">Petal.Width</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">setosa</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">3.5</td>
<td style="text-align: right;">1.4</td>
<td style="text-align: right;">0.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">setosa</td>
<td style="text-align: right;">4.9</td>
<td style="text-align: right;">3.0</td>
<td style="text-align: right;">1.4</td>
<td style="text-align: right;">0.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">setosa</td>
<td style="text-align: right;">4.7</td>
<td style="text-align: right;">3.2</td>
<td style="text-align: right;">1.3</td>
<td style="text-align: right;">0.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">setosa</td>
<td style="text-align: right;">4.6</td>
<td style="text-align: right;">3.1</td>
<td style="text-align: right;">1.5</td>
<td style="text-align: right;">0.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">setosa</td>
<td style="text-align: right;">5.0</td>
<td style="text-align: right;">3.6</td>
<td style="text-align: right;">1.4</td>
<td style="text-align: right;">0.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">setosa</td>
<td style="text-align: right;">5.4</td>
<td style="text-align: right;">3.9</td>
<td style="text-align: right;">1.7</td>
<td style="text-align: right;">0.4</td>
</tr>
</tbody>
</table>
<p>The different datasets that are used throughout the course are collected and briefly described in the short <em>Data</em> chapter.</p>
</section>
<section id="packages" class="level3">
<h3><span class="header-section-number">2.4.2</span> Packages</h3>
<p>We will be using, directly or indirectly, the following packages through the chapters:</p>
<ul>
<li><em><a href="https://CRAN.R-project.org/package=caret">caret</a></em></li>
<li><em><a href="https://CRAN.R-project.org/package=ggplot2">ggplot2</a></em></li>
<li><em><a href="https://CRAN.R-project.org/package=mlbench">mlbench</a></em></li>
<li><em><a href="https://CRAN.R-project.org/package=class">class</a></em></li>
<li><em><a href="https://CRAN.R-project.org/package=caTools">caTools</a></em></li>
<li><em><a href="https://CRAN.R-project.org/package=randomForst">randomForst</a></em></li>
<li><em><a href="https://CRAN.R-project.org/package=impute">impute</a></em></li>
<li><em><a href="https://CRAN.R-project.org/package=ranger">ranger</a></em></li>
<li><em><a href="https://CRAN.R-project.org/package=kernlab">kernlab</a></em></li>
<li><em><a href="https://CRAN.R-project.org/package=class">class</a></em></li>
<li><em><a href="https://CRAN.R-project.org/package=glmnet">glmnet</a></em></li>
<li><em><a href="https://CRAN.R-project.org/package=naivebayes">naivebayes</a></em></li>
<li><em><a href="https://CRAN.R-project.org/package=rpart">rpart</a></em></li>
<li><em><a href="https://CRAN.R-project.org/package=rpart.plot">rpart.plot</a></em></li>
</ul>
<p>See the full session informtion for more details.</p>

</section>
</section>
</section>
<section id="unsupervised-learning" class="level1">
<h1><span class="header-section-number">Chapter 3</span> Unsupervised Learning</h1>
<section id="introduction" class="level2">
<h2><span class="header-section-number">3.1</span> Introduction</h2>
<p>In <strong>unsupervised learning</strong> (UML), no labels are provided, and the learning algorithm focuses solely on detecting structure in unlabelled input data. One generally differentiates between</p>
<ul>
<li><p><strong>Clustering</strong>, where the goal is to find homogeneous subgroups within the data; the grouping is based on distance between observations.</p></li>
<li><p><strong>Dimensionality reduction</strong>, where the goal is to identify patterns in the features of the data. Dimensionality reduction is often used to facilitate visualisation of the data, as well as a pre-processing method before supervised learning.</p></li>
</ul>
<p>UML presents specific challenges and benefits:</p>
<ul>
<li>there is no single goal in UML</li>
<li>there is generally much more unlabelled data available than labelled data.</li>
</ul>
</section>
<section id="k-means-clustering" class="level2">
<h2><span class="header-section-number">3.2</span> k-means clustering</h2>
<p>The k-means clustering algorithms aims at partitioning <em>n</em> observations into a fixed number of <em>k</em> clusters. The algorithm will find homogeneous clusters.</p>
<p>In R, we use</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">stats<span class="op">::</span><span class="kw">kmeans</span>(x, <span class="dt">centers =</span> <span class="dv">3</span>, <span class="dt">nstart =</span> <span class="dv">10</span>)</a></code></pre></div>
<p>where</p>
<ul>
<li><code>x</code> is a numeric data matrix</li>
<li><code>centers</code> is the pre-defined number of clusters</li>
<li>the k-means algorithm has a random component and can be repeated <code>nstart</code> times to improve the returned model</li>
</ul>
<blockquote>
<p>Challenge:</p>
<ul>
<li>To learn about k-means, let’s use the <code>iris</code> with the sepal and petal length variables only (to facilitate visualisation). Create such a data matrix and name it <code>x</code></li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>Run the k-means algorithm on the newly generated data <code>x</code>, save the results in a new variable <code>cl</code>, and explore its output when printed.</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>The actual results of the algorithms, i.e. the cluster membership can be accessed in the <code>clusters</code> element of the clustering result output. Use it to colour the inferred clusters to generate a figure like shown below.</li>
</ul>
</blockquote>
<div class="figure"><span id="fig:solkmplot"></span>
<img src="PhD_Toolbox_2018_files/figure-html/solkmplot-1.png" alt="k-means algorithm on sepal and petal lengths" width="672" />
<p class="caption">
Figure 3.1: k-means algorithm on sepal and petal lengths
</p>
</div>
<details>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">i &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">&quot;Length&quot;</span>, <span class="kw">names</span>(iris))</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">x &lt;-<span class="st"> </span>iris[, i]</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">cl &lt;-<span class="st"> </span><span class="kw">kmeans</span>(x, <span class="dv">3</span>, <span class="dt">nstart =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="kw">plot</span>(x, <span class="dt">col =</span> cl<span class="op">$</span>cluster)</a></code></pre></div>
</details>
<section id="how-does-k-means-work" class="level3">
<h3><span class="header-section-number">3.2.1</span> How does k-means work</h3>
<p><strong>Initialisation</strong>: randomly assign class membership</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">12</span>)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">init &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">3</span>, <span class="kw">nrow</span>(x), <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="kw">plot</span>(x, <span class="dt">col =</span> init)</a></code></pre></div>
<div class="figure"><span id="fig:kmworksinit"></span>
<img src="PhD_Toolbox_2018_files/figure-html/kmworksinit-1.png" alt="k-means random intialisation" width="672" />
<p class="caption">
Figure 3.2: k-means random intialisation
</p>
</div>
<p><strong>Iteration</strong>:</p>
<ol type="1">
<li>Calculate the centre of each subgroup as the average position of all observations is that subgroup.</li>
<li>Each observation is then assigned to the group of its nearest centre.</li>
</ol>
<p>It’s also possible to stop the algorithm after a certain number of iterations, or once the centres move less than a certain distance.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw">plot</span>(x, <span class="dt">col =</span> init)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">centres &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="cf">function</span>(i) <span class="kw">colMeans</span>(x[init <span class="op">==</span><span class="st"> </span>i, ], ))</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">centres &lt;-<span class="st"> </span><span class="kw">t</span>(centres)</a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="kw">points</span>(centres[, <span class="dv">1</span>], centres[, <span class="dv">2</span>], <span class="dt">pch =</span> <span class="dv">19</span>, <span class="dt">col =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb4-6" data-line-number="6"></a>
<a class="sourceLine" id="cb4-7" data-line-number="7">tmp &lt;-<span class="st"> </span><span class="kw">dist</span>(<span class="kw">rbind</span>(centres, x))</a>
<a class="sourceLine" id="cb4-8" data-line-number="8">tmp &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(tmp)[, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]</a>
<a class="sourceLine" id="cb4-9" data-line-number="9"></a>
<a class="sourceLine" id="cb4-10" data-line-number="10">ki &lt;-<span class="st"> </span><span class="kw">apply</span>(tmp, <span class="dv">1</span>, which.min)</a>
<a class="sourceLine" id="cb4-11" data-line-number="11">ki &lt;-<span class="st"> </span>ki[<span class="op">-</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)]</a>
<a class="sourceLine" id="cb4-12" data-line-number="12"></a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="kw">plot</span>(x, <span class="dt">col =</span> ki)</a>
<a class="sourceLine" id="cb4-14" data-line-number="14"><span class="kw">points</span>(centres[, <span class="dv">1</span>], centres[, <span class="dv">2</span>], <span class="dt">pch =</span> <span class="dv">19</span>, <span class="dt">col =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</a></code></pre></div>
<div class="figure"><span id="fig:kmworksiter"></span>
<img src="PhD_Toolbox_2018_files/figure-html/kmworksiter-1.png" alt="k-means iteration: calculate centers (left) and assign new cluster membership (right)" width="1152" />
<p class="caption">
Figure 3.3: k-means iteration: calculate centers (left) and assign new cluster membership (right)
</p>
</div>
<p><strong>Termination</strong>: Repeat iteration until no point changes its cluster membership.</p>
<figure>
<img src="https://upload.wikimedia.org/wikipedia/commons/e/ea/K-means_convergence.gif" alt="k-means convergence (credit Wikipedia)" /><figcaption>k-means convergence (credit Wikipedia)</figcaption>
</figure>
</section>
<section id="model-selection" class="level3">
<h3><span class="header-section-number">3.2.2</span> Model selection</h3>
<p>Due to the random initialisation, one can obtain different clustering results. When k-means is run multiple times, the best outcome, i.e. the one that generates the smallest <em>total within cluster sum of squares (SS)</em>, is selected. The total within SS is calculated as:</p>
<p>For each cluster results:</p>
<ul>
<li>for each observation, determine the squared euclidean distance from observation to centre of cluster</li>
<li>sum all distances</li>
</ul>
<p>Note that this is a <strong>local minimum</strong>; there is no guarantee to obtain a global minimum.</p>
<blockquote>
<p>Challenge:</p>
<p>Repeat kmeans on our <code>x</code> data multiple times, setting the number of iterations to 1 or greater and check whether you repeatedly obtain the same results. Try the same with random data of identical dimensions.</p>
</blockquote>
<details>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">cl1 &lt;-<span class="st"> </span><span class="kw">kmeans</span>(x, <span class="dt">centers =</span> <span class="dv">3</span>, <span class="dt">nstart =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">cl2 &lt;-<span class="st"> </span><span class="kw">kmeans</span>(x, <span class="dt">centers =</span> <span class="dv">3</span>, <span class="dt">nstart =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="kw">table</span>(cl1<span class="op">$</span>cluster, cl2<span class="op">$</span>cluster)</a></code></pre></div>
<pre><code>##    
##      1  2  3
##   1 58  0  0
##   2  0 41  0
##   3  0  0 51</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">cl1 &lt;-<span class="st"> </span><span class="kw">kmeans</span>(x, <span class="dt">centers =</span> <span class="dv">3</span>, <span class="dt">nstart =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">cl2 &lt;-<span class="st"> </span><span class="kw">kmeans</span>(x, <span class="dt">centers =</span> <span class="dv">3</span>, <span class="dt">nstart =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="kw">table</span>(cl1<span class="op">$</span>cluster, cl2<span class="op">$</span>cluster)</a></code></pre></div>
<pre><code>##    
##      1  2  3
##   1  0  0 41
##   2  0 51  0
##   3 58  0  0</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">42</span>)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">xr &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="kw">prod</span>(<span class="kw">dim</span>(x))), <span class="dt">ncol =</span> <span class="kw">ncol</span>(x))</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">cl1 &lt;-<span class="st"> </span><span class="kw">kmeans</span>(xr, <span class="dt">centers =</span> <span class="dv">3</span>, <span class="dt">nstart =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb9-4" data-line-number="4">cl2 &lt;-<span class="st"> </span><span class="kw">kmeans</span>(xr, <span class="dt">centers =</span> <span class="dv">3</span>, <span class="dt">nstart =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="kw">table</span>(cl1<span class="op">$</span>cluster, cl2<span class="op">$</span>cluster)</a></code></pre></div>
<pre><code>##    
##      1  2  3
##   1 46  0  6
##   2  1 51  0
##   3  0  1 45</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">diffres &lt;-<span class="st"> </span>cl1<span class="op">$</span>cluster <span class="op">!=</span><span class="st"> </span>cl2<span class="op">$</span>cluster</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="kw">plot</span>(xr, <span class="dt">col =</span> cl1<span class="op">$</span>cluster, <span class="dt">pch =</span> <span class="kw">ifelse</span>(diffres, <span class="dv">19</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="kw">plot</span>(xr, <span class="dt">col =</span> cl2<span class="op">$</span>cluster, <span class="dt">pch =</span> <span class="kw">ifelse</span>(diffres, <span class="dv">19</span>, <span class="dv">1</span>))</a></code></pre></div>
<div class="figure"><span id="fig:selrep"></span>
<img src="PhD_Toolbox_2018_files/figure-html/selrep-1.png" alt="Different k-means results on the same (random) data" width="1152" />
<p class="caption">
Figure 3.4: Different k-means results on the same (random) data
</p>
</div>
</details>
</section>
<section id="how-to-determine-the-number-of-clusters" class="level3">
<h3><span class="header-section-number">3.2.3</span> How to determine the number of clusters</h3>
<ol type="1">
<li>Run k-means with <code>k=1</code>, <code>k=2</code>, …, <code>k=n</code></li>
<li>Record total within SS for each value of k.</li>
<li>Choose k at the <em>elbow</em> position, as illustrated below.</li>
</ol>
<p><img src="PhD_Toolbox_2018_files/figure-html/kmelbow-1.png" width="672" /></p>
<blockquote>
<p>Challenge</p>
<p>Calculate the total within sum of squares for k from 1 to 5 for our <code>x</code> test data, and reproduce the figure above.</p>
</blockquote>
<details>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">ks &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">5</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2">tot_within_ss &lt;-<span class="st"> </span><span class="kw">sapply</span>(ks, <span class="cf">function</span>(k) {</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">    cl &lt;-<span class="st"> </span><span class="kw">kmeans</span>(x, k, <span class="dt">nstart =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb12-4" data-line-number="4">    cl<span class="op">$</span>tot.withinss</a>
<a class="sourceLine" id="cb12-5" data-line-number="5">})</a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="kw">plot</span>(ks, tot_within_ss, <span class="dt">type =</span> <span class="st">&quot;b&quot;</span>)</a></code></pre></div>
<img src="PhD_Toolbox_2018_files/figure-html/solkmelbow-1.png" width="672" />
</details>
</section>
</section>
<section id="hierarchical-clustering" class="level2">
<h2><span class="header-section-number">3.3</span> Hierarchical clustering</h2>
<section id="how-does-hierarchical-clustering-work" class="level3">
<h3><span class="header-section-number">3.3.1</span> How does hierarchical clustering work</h3>
<p><strong>Initialisation</strong>: Starts by assigning each of the n point its own cluster</p>
<p><strong>Iteration</strong></p>
<ol type="1">
<li>Find the two nearest clusters, and join them together, leading to n-1 clusters</li>
<li>Continue merging cluster process until all are grouped into a single cluster</li>
</ol>
<p><strong>Termination:</strong> All observations are grouped within a single cluster.</p>
<div class="figure"><span id="fig:hcldata"></span>
<img src="PhD_Toolbox_2018_files/figure-html/hcldata-1.png" alt="Hierarchical clustering: initialisation (left) and colour-coded results after iteration (right)." width="1152" />
<p class="caption">
Figure 3.5: Hierarchical clustering: initialisation (left) and colour-coded results after iteration (right).
</p>
</div>
<p>The results of hierarchical clustering are typically visualised along a <strong>dendrogram</strong>, where the distance between the clusters is proportional to the branch lengths.</p>
<div class="figure"><span id="fig:hcldendro"></span>
<img src="PhD_Toolbox_2018_files/figure-html/hcldendro-1.png" alt="Visualisation of the hierarchical clustering results on a dendrogram" width="672" />
<p class="caption">
Figure 3.6: Visualisation of the hierarchical clustering results on a dendrogram
</p>
</div>
<p>In R:</p>
<ul>
<li>Calculate the distance using <code>dist</code>, typically the Euclidean distance.</li>
<li>Hierarchical clustering on this distance matrix using <code>hclust</code></li>
</ul>
<blockquote>
<p>Challenge</p>
<p>Apply hierarchical clustering on the <code>iris</code> data and generate a dendrogram using the dedicated <code>plot</code> method.</p>
</blockquote>
<details>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">d &lt;-<span class="st"> </span><span class="kw">dist</span>(iris[, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>])</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">hcl &lt;-<span class="st"> </span><span class="kw">hclust</span>(d)</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">hcl</a></code></pre></div>
<pre><code>## 
## Call:
## hclust(d = d)
## 
## Cluster method   : complete 
## Distance         : euclidean 
## Number of objects: 150</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw">plot</span>(hcl)</a></code></pre></div>
<img src="PhD_Toolbox_2018_files/figure-html/hclsol-1.png" width="672" />
</details>
</section>
<section id="defining-clusters" class="level3">
<h3><span class="header-section-number">3.3.2</span> Defining clusters</h3>
<p>After producing the hierarchical clustering result, we need to <em>cut the tree (dendrogram)</em> at a specific height to defined the clusters. For example, on our test dataset above, we could decide to cut it at a distance around 1.5, with would produce 2 clusters.</p>
<div class="figure"><span id="fig:cuthcl"></span>
<img src="PhD_Toolbox_2018_files/figure-html/cuthcl-1.png" alt="Cutting the dendrogram at height 1.5." width="672" />
<p class="caption">
Figure 3.7: Cutting the dendrogram at height 1.5.
</p>
</div>
<p>In R we can us the <code>cutree</code> function to</p>
<ul>
<li>cut the tree at a specific height: <code>cutree(hcl, h = 1.5)</code></li>
<li>cut the tree to get a certain number of clusters: <code>cutree(hcl, k = 2)</code></li>
</ul>
<blockquote>
<p>Challenge</p>
<ul>
<li>Cut the iris hierarchical clustering result at a height to obtain 3 clusters by setting <code>h</code>.</li>
<li>Cut the iris hierarchical clustering result at a height to obtain 3 clusters by setting directly <code>k</code>, and verify that both provide the same results.</li>
</ul>
</blockquote>
<details>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw">plot</span>(hcl)</a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="kw">abline</span>(<span class="dt">h =</span> <span class="fl">3.9</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</a></code></pre></div>
<p><img src="PhD_Toolbox_2018_files/figure-html/cuthclsol-1.png" width="672" /></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw">cutree</span>(hcl, <span class="dt">k =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>##   [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
##  [36] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 2 3 2 3 2 3 2 3 3 3 3 2 3 2 3 3 2 3
##  [71] 2 3 2 2 2 2 2 2 2 3 3 3 3 2 3 2 2 2 3 3 3 2 3 3 3 3 3 2 3 3 2 2 2 2 2
## [106] 2 3 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
## [141] 2 2 2 2 2 2 2 2 2 2</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw">cutree</span>(hcl, <span class="dt">h =</span> <span class="fl">3.9</span>)</a></code></pre></div>
<pre><code>##   [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
##  [36] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 2 3 2 3 2 3 2 3 3 3 3 2 3 2 3 3 2 3
##  [71] 2 3 2 2 2 2 2 2 2 3 3 3 3 2 3 2 2 2 3 3 3 2 3 3 3 3 3 2 3 3 2 2 2 2 2
## [106] 2 3 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
## [141] 2 2 2 2 2 2 2 2 2 2</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw">identical</span>(<span class="kw">cutree</span>(hcl, <span class="dt">k =</span> <span class="dv">3</span>), <span class="kw">cutree</span>(hcl, <span class="dt">h =</span> <span class="fl">3.9</span>))</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</details>
<blockquote>
<p>Challenge</p>
<p>Using the same value <code>k = 3</code>, verify if k-means and hierarchical clustering produce the same results on the <code>iris</code> data.</p>
<p>Which one, if any, is correct?</p>
</blockquote>
<details>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1">km &lt;-<span class="st"> </span><span class="kw">kmeans</span>(iris[, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>], <span class="dt">centers =</span> <span class="dv">3</span>, <span class="dt">nstart =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb23-2" data-line-number="2">hcl &lt;-<span class="st"> </span><span class="kw">hclust</span>(<span class="kw">dist</span>(iris[, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]))</a>
<a class="sourceLine" id="cb23-3" data-line-number="3"><span class="kw">table</span>(km<span class="op">$</span>cluster, <span class="kw">cutree</span>(hcl, <span class="dt">k =</span> <span class="dv">3</span>))</a></code></pre></div>
<pre><code>##    
##      1  2  3
##   1  0 38  0
##   2 50  0  0
##   3  0 34 28</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb25-2" data-line-number="2"><span class="kw">plot</span>(iris<span class="op">$</span>Petal.Length, iris<span class="op">$</span>Sepal.Length, <span class="dt">col =</span> km<span class="op">$</span>cluster, <span class="dt">main =</span> <span class="st">&quot;k-means&quot;</span>)</a>
<a class="sourceLine" id="cb25-3" data-line-number="3"><span class="kw">plot</span>(iris<span class="op">$</span>Petal.Length, iris<span class="op">$</span>Sepal.Length, <span class="dt">col =</span> <span class="kw">cutree</span>(hcl, <span class="dt">k =</span> <span class="dv">3</span>), <span class="dt">main =</span> <span class="st">&quot;Hierarchical clustering&quot;</span>)</a></code></pre></div>
<p><img src="PhD_Toolbox_2018_files/figure-html/iris2algs-1.png" width="1152" /></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1">## Checking with the labels provided with the iris data</a>
<a class="sourceLine" id="cb26-2" data-line-number="2"><span class="kw">table</span>(iris<span class="op">$</span>Species, km<span class="op">$</span>cluster)</a></code></pre></div>
<pre><code>##             
##               1  2  3
##   setosa      0 50  0
##   versicolor  2  0 48
##   virginica  36  0 14</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="kw">table</span>(iris<span class="op">$</span>Species, <span class="kw">cutree</span>(hcl, <span class="dt">k =</span> <span class="dv">3</span>))</a></code></pre></div>
<pre><code>##             
##               1  2  3
##   setosa     50  0  0
##   versicolor  0 23 27
##   virginica   0 49  1</code></pre>
</details>
</section>
</section>
<section id="pre-processing" class="level2">
<h2><span class="header-section-number">3.4</span> Pre-processing</h2>
<p>Many of the machine learning methods that are regularly used are sensitive to difference scales. This applies to unsupervised methods as well as supervised methods, as we will see in the next chapter.</p>
<p>A typical way to pre-process the data prior to learning is to scale the data, or apply principal component analysis (next section). Scaling assures that all data columns have mean 0 and standard deviate 1.</p>
<p>In R, scaling is done with the <code>scale</code> function.</p>
<blockquote>
<p>Challenge</p>
<p>Using the <code>mtcars</code> data as an example, verify that the variables are of different scales, then scale the data. To observe the effect different scales, compare the hierarchical clusters obtained on the original and scaled data.</p>
</blockquote>
<details>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="kw">colMeans</span>(mtcars)</a></code></pre></div>
<pre><code>##        mpg        cyl       disp         hp       drat         wt 
##  20.090625   6.187500 230.721875 146.687500   3.596563   3.217250 
##       qsec         vs         am       gear       carb 
##  17.848750   0.437500   0.406250   3.687500   2.812500</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1">hcl1 &lt;-<span class="st"> </span><span class="kw">hclust</span>(<span class="kw">dist</span>(mtcars))</a>
<a class="sourceLine" id="cb32-2" data-line-number="2">hcl2 &lt;-<span class="st"> </span><span class="kw">hclust</span>(<span class="kw">dist</span>(<span class="kw">scale</span>(mtcars)))</a>
<a class="sourceLine" id="cb32-3" data-line-number="3"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb32-4" data-line-number="4"><span class="kw">plot</span>(hcl1, <span class="dt">main =</span> <span class="st">&quot;original data&quot;</span>)</a>
<a class="sourceLine" id="cb32-5" data-line-number="5"><span class="kw">plot</span>(hcl2, <span class="dt">main =</span> <span class="st">&quot;scaled data&quot;</span>)</a></code></pre></div>
<img src="PhD_Toolbox_2018_files/figure-html/scalesol-1.png" width="1152" />
</details>
</section>
<section id="principal-component-analysis-pca" class="level2">
<h2><span class="header-section-number">3.5</span> Principal component analysis (PCA)</h2>
<p><strong>Dimensionality reduction</strong> techniques are widely used and versatile techniques that can be used o</p>
<ul>
<li>find structure in features</li>
<li>pre-processing for other ML algorithms, and</li>
<li>as an aid in visualisation.</li>
</ul>
<p>The basic principle of dimensionality reduction techniques is to transform the data into a new space that summarise properties of the whole data set along a reduced number of dimensions. These are then ideal candidates used to visualise the data along these reduced number of informative dimensions.</p>
<section id="how-does-it-work" class="level3">
<h3><span class="header-section-number">3.5.1</span> How does it work</h3>
<p>Principal Component Analysis (PCA) is a technique that transforms the original n-dimensional data into a new n-dimensional space.</p>
<ul>
<li>These new dimensions are linear combinations of the original data, i.e. they are composed of proportions of the original variables.</li>
<li>Along these new dimensions, called principal components, the data expresses most of its variability along the first PC, then second, …</li>
<li>Principal components are orthogonal to each other, i.e. non-correlated.</li>
</ul>
<div class="figure"><span id="fig:pcaex"></span>
<img src="PhD_Toolbox_2018_files/figure-html/pcaex-1.png" alt="Original data (left). PC1 will maximise the variability while minimising the residuals (centre). PC2 is orthogonal to PC1 (right)." width="1152" />
<p class="caption">
Figure 3.8: Original data (left). PC1 will maximise the variability while minimising the residuals (centre). PC2 is orthogonal to PC1 (right).
</p>
</div>
<p>In R, we can use the <code>prcomp</code> function.</p>
<p>Let’s explore PCA on the <code>iris</code> data. While it contains only 4 variables, is already becomes difficult to visualise the 3 groups along all these dimensions.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1"><span class="kw">pairs</span>(iris[, <span class="dv">-5</span>], <span class="dt">col =</span> iris[, <span class="dv">5</span>], <span class="dt">pch =</span> <span class="dv">19</span>)</a></code></pre></div>
<p><img src="PhD_Toolbox_2018_files/figure-html/irispairs-1.png" width="672" /></p>
<p>Let’s use PCA to reduce the dimension.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1">irispca &lt;-<span class="st"> </span><span class="kw">prcomp</span>(iris[, <span class="dv">-5</span>])</a>
<a class="sourceLine" id="cb34-2" data-line-number="2"><span class="kw">summary</span>(irispca)</a></code></pre></div>
<pre><code>## Importance of components:
##                           PC1     PC2    PC3     PC4
## Standard deviation     2.0563 0.49262 0.2797 0.15439
## Proportion of Variance 0.9246 0.05307 0.0171 0.00521
## Cumulative Proportion  0.9246 0.97769 0.9948 1.00000</code></pre>
<p>A summary of the <code>prcomp</code> output shows that along PC1 along, we are able to retain over 92% of the total variability in the data.</p>
<div class="figure"><span id="fig:histpc1"></span>
<img src="PhD_Toolbox_2018_files/figure-html/histpc1-1.png" alt="Iris data along PC1." width="672" />
<p class="caption">
Figure 3.9: Iris data along PC1.
</p>
</div>
</section>
<section id="visualisation" class="level3">
<h3><span class="header-section-number">3.5.2</span> Visualisation</h3>
<p>A <strong>biplot</strong> features all original points re-mapped (rotated) along the first two PCs as well as the original features as vectors along the same PCs. Feature vectors that are in the same direction in PC space are also correlated in the original data space.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1"><span class="kw">biplot</span>(irispca)</a></code></pre></div>
<p><img src="PhD_Toolbox_2018_files/figure-html/irisbiplot-1.png" width="672" /></p>
<p>One important piece of information when using PCA is the proportion of variance explained along the PCs, in particular when dealing with high dimensional data, as PC1 and PC2 (that are generally used for visualisation), might only account for an insufficient proportion of variance to be relevant on their own.</p>
<p>In the code chunk below, I extract the standard deviations from the PCA result to calculate the variances, then obtain the percentage of and cumulative variance along the PCs.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1">var &lt;-<span class="st"> </span>irispca<span class="op">$</span>sdev<span class="op">^</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb37-2" data-line-number="2">(pve &lt;-<span class="st"> </span>var<span class="op">/</span><span class="kw">sum</span>(var))</a></code></pre></div>
<pre><code>## [1] 0.924618723 0.053066483 0.017102610 0.005212184</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1"><span class="kw">cumsum</span>(pve)</a></code></pre></div>
<pre><code>## [1] 0.9246187 0.9776852 0.9947878 1.0000000</code></pre>
<blockquote>
<p>Challenge</p>
<ul>
<li>Repeat the PCA analysis on the iris dataset above, reproducing the biplot and preparing a barplot of the percentage of variance explained by each PC.</li>
<li>It is often useful to produce custom figures using the data coordinates in PCA space, which can be accessed as <code>x</code> in the <code>prcomp</code> object. Reproduce the PCA plots below, along PC1 and PC2 and PC3 and PC4 respectively.</li>
</ul>
</blockquote>
<p><img src="PhD_Toolbox_2018_files/figure-html/irispcax-1.png" width="1152" /></p>
<details>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb41-2" data-line-number="2"><span class="kw">plot</span>(irispca<span class="op">$</span>x[, <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>], <span class="dt">col =</span> iris<span class="op">$</span>Species)</a>
<a class="sourceLine" id="cb41-3" data-line-number="3"><span class="kw">plot</span>(irispca<span class="op">$</span>x[, <span class="dv">3</span><span class="op">:</span><span class="dv">4</span>], <span class="dt">col =</span> iris<span class="op">$</span>Species)</a></code></pre></div>
</details>
</section>
<section id="data-pre-processing" class="level3">
<h3><span class="header-section-number">3.5.3</span> Data pre-processing</h3>
<p>We haven’t looked at other <code>prcomp</code> parameters, other that the first one, <code>x</code>. There are two other ones that are or importance, in particular in the light of the section on pre-processing above, which are <code>center</code> and <code>scale.</code>. The former is set to <code>TRUE</code> by default, while the second one is set the <code>FALSE</code>.</p>
<blockquote>
<p>Challenge</p>
<p>Repeat the analysis comparing the need for scaling on the <code>mtcars</code> dataset, but using PCA instead of hierarchical clustering. When comparing the two.</p>
</blockquote>
<details>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb42-2" data-line-number="2"><span class="kw">biplot</span>(<span class="kw">prcomp</span>(mtcars, <span class="dt">scale =</span> <span class="ot">FALSE</span>), <span class="dt">main =</span> <span class="st">&quot;No scaling&quot;</span>)  ## 1</a>
<a class="sourceLine" id="cb42-3" data-line-number="3"><span class="kw">biplot</span>(<span class="kw">prcomp</span>(mtcars, <span class="dt">scale =</span> <span class="ot">TRUE</span>), <span class="dt">main =</span> <span class="st">&quot;With scaling&quot;</span>) ## 2</a></code></pre></div>
<p><img src="PhD_Toolbox_2018_files/figure-html/scalepcasol-1.png" width="672" /></p>
Without scaling, <code>disp</code> and <code>hp</code> are the features with the highest loadings along PC1 and 2 (all others are negligible), which are also those with the highest units of measurement. Scaling removes this effect.
</details>
</section>
<section id="final-comments-on-pca" class="level3">
<h3><span class="header-section-number">3.5.4</span> Final comments on PCA</h3>
<p>Real datasets often come with <strong>missing values</strong>. In R, these should be encoded using <code>NA</code>. Unfortunately, PCA cannot deal with missing values, and observations containing <code>NA</code> values will be dropped automatically. This is a viable solution only when the proportion of missing values is low.</p>
<p>It is also possible to impute missing values. This is described in greater details in the <em>Data pre-processing</em> section in the supervised machine learning chapter.</p>
<p>Finally, we should be careful when using categorical data in any of the unsupervised methods described above. Categories are generally represented as factors, which are encoded as integer levels, and might give the impression that a distance between levels is a relevant measure (which it is not, unless the factors are ordered). In such situations, categorical data can be dropped, or it is possible to encode categories as binary <strong>dummy variables</strong>. For example, if we have 3 categories, say <code>A</code>, <code>B</code> and <code>C</code>, we would create two dummy variables to encode the categories as:</p>
<table>
<thead>
<tr class="header">
<th></th>
<th style="text-align: right;">x</th>
<th style="text-align: right;">y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td>B</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td>C</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
<p>so that the distance between each category are approximately equal to 1.</p>
</section>
</section>
<section id="t-distributed-stochastic-neighbour-embedding" class="level2">
<h2><span class="header-section-number">3.6</span> t-Distributed Stochastic Neighbour Embedding</h2>
<p><a href="https://lvdmaaten.github.io/tsne/">t-Distributed Stochastic Neighbour Embedding</a> (t-SNE) is a <em>non-linear</em> dimensionality reduction technique, i.e. that different regions of the data space will be subjected to different transformations. t-SNE will compress small distances, thus bringing close neighbours together, and will ignore large distances. It is particularly well suited for <a href="https://distill.pub/2016/misread-tsne/">very high dimensional data</a>.</p>
<p>In R, we can use the <code>Rtsne</code> function from the <em><a href="https://CRAN.R-project.org/package=Rtsne">Rtsne</a></em>. Before, we however need to remove any duplicated entries in the dataset.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;Rtsne&quot;</span>)</a>
<a class="sourceLine" id="cb43-2" data-line-number="2">uiris &lt;-<span class="st"> </span><span class="kw">unique</span>(iris[, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>])</a>
<a class="sourceLine" id="cb43-3" data-line-number="3">iristsne &lt;-<span class="st"> </span><span class="kw">Rtsne</span>(uiris[, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>])</a>
<a class="sourceLine" id="cb43-4" data-line-number="4"><span class="kw">plot</span>(iristsne<span class="op">$</span>Y, <span class="dt">col =</span> uiris<span class="op">$</span>Species)</a></code></pre></div>
<p><img src="PhD_Toolbox_2018_files/figure-html/iristsne-1.png" width="672" /></p>
<p>As with PCA, the data can be scaled and centred prior the running t-SNE (see the <code>pca_center</code> and <code>pca_scale</code> arguments). The algorithm is stochastic, and will produce different results at each repetition.</p>
<section id="parameter-tuning" class="level3">
<h3><span class="header-section-number">3.6.1</span> Parameter tuning</h3>
<p>t-SNE (as well as many other methods, in particular classification algorithms) has two important parameters that can substantially influence the clustering of the data</p>
<ul>
<li><strong>Perplexity</strong>: balances global and local aspects of the data.</li>
<li><strong>Iterations</strong>: number of iterations before the clustering is stopped.</li>
</ul>
<p>It is important to adapt these for different data. The figure below shows a 5032 by 20 dataset that represent protein sub-cellular localisation.</p>
<figure>
<img src="https://raw.githubusercontent.com/lgatto/visualisation/master/figure/tsnesplots-1.png" alt="Effect of different perplexity and iterations when running t-SNE" /><figcaption>Effect of different perplexity and iterations when running t-SNE</figcaption>
</figure>
<p>As a comparison, below are the same data with PCA (left) and t-SNE (right).</p>
<figure>
<img src="https://raw.githubusercontent.com/lgatto/visualisation/master/figure/tsneex-1.png" alt="PCA and t-SNE on hyperLOPIT" /><figcaption>PCA and t-SNE on hyperLOPIT</figcaption>
</figure>

</section>
</section>
</section>
            </section>

          </div>
        </div>
      </div>


    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
